let jwt,comparePassword,hashPassword,User;_5a3‍.x([["register",()=>register],["login",()=>login],["logout",()=>logout]]);_5a3‍.w("jsonwebtoken",[["default",["jwt"],function(v){jwt=v}]]);_5a3‍.w("../helper/auth",[["comparePassword",["comparePassword"],function(v){comparePassword=v}],["hashPassword",["hashPassword"],function(v){hashPassword=v}]]);_5a3‍.w("../models/user",[["default",["User"],function(v){User=v}]]);


       const register=async(req, res)=>{
   try{
       const {name, email, password, condition}= req.body;
       //validations
       if (!name) return res.status(400).send("Name is must be provided");
       if(!password || password.length < 8) {
           
        return res.status(400).send("Password must be 8 character long")
    }
    let userExists = await User.findOne({email}).exec();
    if (userExists) return res.status(400).send("email is taken");
    
//hash password
const hashedPassword = await hashPassword(password);
     //register user
    const user = new User({
        name,
        email,
        password:hashedPassword,
        condition,
    });
    await user.save();
    return res.json({ ok: true });

   }catch(err){
       _5a3‍.g.console.log(err);
       return res.status(400).send("error. try again later")
   }
}

       const login = async (req, res)=>{
  try{
    const {email, password} = req.body;
    //check whether we have the user or not with that email
    const user= await User.findOne({email}).exec();
    _5a3‍.g.console.log(user);
    if(!user) return res.status(400).send("No user found");
    //check password
    const match = await comparePassword(password, user.password);
    //create singed jw tokens
    const token = jwt.sign({_id:user._id}, process.env.JWT_SECRET, {expiresIn:"5d"});
    user.password= undefined;
    res.cookie("token", token,{
        httpOnly: true,
    });
    res.json(user);

  }catch(err){
      _5a3‍.g.console.log(err);
      return res.status(400).send("Error, Please try again");
  }
}

       const logout = async (req, res) => {
    try{
        res.clearCookie("token");
        return res.json({message:"Signout Success"})

    }catch(err){
        _5a3‍.g.console.log(err);
    }
}